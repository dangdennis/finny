bucket_definitions:
  profiles_by_user:
    parameters: select id as user_id from profiles where profiles.id = token_parameters.user_id
    data:
      - select
        id,
        age,
        date_of_birth,
        retirement_age
        from profiles where id = bucket.user_id
  accounts_by_user:
    parameters: select id as user_id from profiles where profiles.id = token_parameters.user_id
    data:
      - select
        id,
        item_id,
        user_id,
        name,
        mask,
        official_name,
        current_balance,
        available_balance,
        iso_currency_code,
        unofficial_currency_code,
        type,
        subtype,
        created_at,
        updated_at,
        deleted_at
        from accounts
        where user_id = bucket.user_id
  transactions_by_account:
    parameters: select id as account_id from accounts where accounts.user_id = token_parameters.user_id
    data:
      - select
        id,
        account_id,
        category,
        subcategory,
        type,
        name,
        amount,
        iso_currency_code,
        unofficial_currency_code,
        date,
        pending,
        account_owner,
        created_at,
        updated_at,
        deleted_at
        from transactions where account_id = bucket.account_id
  holdings_by_account:
    parameters: select id as account_id from accounts where accounts.user_id = token_parameters.user_id
    data:
      - select
        id,
        account_id,
        institution_price,
        institution_price_as_of,
        institution_value,
        cost_basis,
        quantity,
        iso_currency_code,
        vested_value,
        created_at,
        updated_at,
        deleted_at
        from investment_holdings where account_id = bucket.account_id
  goals_by_user:
    parameters: select id as user_id from profiles where profiles.id = token_parameters.user_id
    data:
      - select
        id,
        name,
        amount,
        target_date,
        user_id,
        progress,
        created_at,
        updated_at,
        deleted_at
        from goals where user_id = bucket.user_id
  goal_accounts_by_account:
    parameters: select id as account_id from accounts where accounts.user_id = token_parameters.user_id
    data:
      - select
        id,
        goal_id,
        account_id,
        amount,
        percentage,
        created_at,
        updated_at,
        deleted_at
        from goal_accounts where account_id = bucket.account_id
